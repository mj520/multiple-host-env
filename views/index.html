<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title><%=title%></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">  
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <link href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/notify/0.4.2/notify.min.js"></script>
    <script src="https://cdn.bootcss.com/vue/2.5.16/vue.min.js"></script>
    <script>
        $(function(){
            $.notify.defaults({"globalPosition":"top center"});
            $("#configButton").click(function(){
                $("#configDiv").toggle();
            });
            $("#evnSelect").change(function(){
                var env = $(this).val();
                $.get("/change?env="+env,function(d){
                    if(d.f){
                        $.notify(d.m,"success");
                    }else{
                        $.notify(d.m,"error");
                    }
                },"json");
            });
            
        });
    </script>
</head>
<body>
<div class="alert alert-success" role="alert" style="width: 100%; margin: 0px auto;">
    <div>
        当前环境 <select class="custom-select" style="max-width: 200px;" id="evnSelect">
          <%for(env in envList) {%>
          <option value="<%= env %>" <% if(env == currentEnv) { %> selected <% } %> ><%= env %></option>
          <%}%>
        </select><button type="button" class="btn btn-info float-right" id="configButton" title="show or hide">config</button>
    </div>
    <div style="display: none;" id="configDiv">
        <pre><%= JSON.stringify(config,null,4) %></pre>
    </div>
</div>
<div id="app" class="table-responsive">
    <table class="table table-striped .table-responsive">
      <thead>
        <tr>
          <th scope="col">host</th>
          <th scope="col">ip</th>
          <th scope="col">time</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="item in proxyList">
          <th scope="row" >{{ item.host }}</th>      
          <td>{{ item.ip }}</td>
          <td style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">{{ item.time }}</td>
        </tr>
      </tbody>
    </table>
</div>
 
<script>
var vm = new Vue({
  el: '#app',
  data: {
    proxyList:<%- JSON.stringify(proxyList) %>
  },
  methods: {
    init:function(){
        _this = this;
        setInterval(function(){
            $.get("/proxyList",function(d){
                if(d.f){
                    _this.proxyList = d.d;
                }else{
                    $.notify(d.m,"error");
                }
            },"json");
        },3000);
    }
  }
});
vm.init();
</script>
</body>
</html>